(()=>{"use strict";var e={766:function(e,t,o){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(o(252)),i=s(o(577)),d=o(252),a=s(o(718)),r=s(o(898)),u=(0,n.default)();u.use((0,i.default)()),u.use((0,d.json)()),u.use((0,r.default)()),u.use("/api/v1",a.default),t.default=u},257:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET CHATS`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.industry;if(console.log(d),!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u);if(d&&"all"!==d.toLowerCase()){const{data:e,error:o}=yield l.from("chat").select().eq("user_id",i).eq("industry",d);if(o)return t.status(500),void t.send({ok:!1,data:[],message:o.message});t.status(200),t.send({ok:!0,data:e,message:"success"})}else{const{data:e,error:o}=yield l.from("chat").select().eq("user_id",i);if(o)return t.status(500),void t.send({ok:!1,data:[],message:o.message});t.status(200),t.send({ok:!0,data:e,message:"success"})}}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d,u;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST CHAT`);let l=(null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title)||"New Chat";const c=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.user_id,v=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.created_at,g=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.chat_id,m=null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.industry;if(!c)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!g)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request. No Chat ID provided."});if(!m)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request. No Industry provided."});const f=r.default.sign({sub:c,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),_=(0,a.createClient)({req:e,res:t},f),{data:h,error:p}=yield _.from("chat").select().eq("user_id",c).eq("industry",m).like("title",`%${l}%`);if(p)return t.status(500),void t.send({ok:!1,data:[],message:p.message});h&&h.length>1&&(l+=` ${h.length}`);const{data:y,error:E}=yield _.from("chat").upsert({id:g,created_at:v,user_id:c,title:l,industry:m}).select().single();return E?(t.status(500),void t.send({ok:!1,data:[],message:E.message})):(console.log(y),t.status(200),void t.send({ok:!0,data:y,message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET CHAT`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{data:c,error:v}=yield l.from("chat").select().eq("user_id",i).eq("id",d).single();if(v)return t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").patch(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – PATCH CHAT`);const d=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title,u=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id,l=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.user_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!l)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const c=r.default.sign({sub:l,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,a.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("chat").update({title:d}).eq("id",u).select().single();if(m)return t.status(500),void t.send({ok:!1,data:[],message:m.message});t.status(200),t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").delete(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – DELETE CHAT`);const i=null===(s=null==e?void 0:e.params)||void 0===s?void 0:s.id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.user_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{error:c}=yield l.from("chat").delete().eq("id",i).eq("user_id",d).single();return c?(t.status(500),void t.send({ok:!1,data:[],message:c.message})):(t.status(200),void t.send({ok:!0,data:[],message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},827:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(356),d=n(o(252));n(o(818)).default.config();const a=d.default.Router(),r=new i.ChromaClient({path:process.env.CHROMADB_PRO_URL});a.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){const e=yield r.listCollections();e&&e.length>0&&t.send(e)})))),t.default=a},237:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=n(o(938)),r=o(376),u=n(o(829));d.default.config();const l=i.default.Router();l.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET COMPLETIONS`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.chat_id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const a=u.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,r.createClient)({req:e,res:t},a),{data:c,error:v}=yield l.from("chat_completion").select().eq("user_id",i).eq("chat_id",d).order("created",{ascending:!0});if(v)return console.log(v),t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),l.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d,l,c,v;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST COMPLETION`);const g=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.user_input,m=(null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.messages)||[],f=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.user_id,_=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.chat_id;if(!g)return t.status(400),void t.send({ok:!1,data:[],message:"No User Input Provided"});if(!f)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!_)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});const h=u.default.sign({sub:f,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),p=(0,r.createClient)({req:e,res:t},h),{data:y,error:E}=yield p.from("chat").select().eq("id",_).single();if(E)return console.log(E),t.status(500),void t.send({ok:!1,data:[],message:E.message});const k=y.industry||"",{data:S,error:q}=yield p.from("industry").select().eq("name",k).single();q&&console.log(q);const b=yield(0,r.getRelatedDocs)(g,"all"===(null===(l=null==S?void 0:S.name)||void 0===l?void 0:l.toLowerCase())?"all-industries":(null===(c=null==S?void 0:S.name)||void 0===c?void 0:c.toLowerCase())||""),C=null===(v=null==b?void 0:b.at(0))||void 0===v?void 0:v.map((e=>null==e?void 0:e.replace("\n"," ")));console.log(C);const A=yield(0,r.customGoogleSearch)(g);console.log(A);const I=yield a.default.post("https://api.openai.com/v1/chat/completions",{model:"gpt-4-turbo-preview",messages:[...m,{role:"system",content:((null==S?void 0:S.system_directive)||"Your name is Higgins. You are a helpful AI assistant. You may be provided with some supporting context that you can use to help you respond to the user's next prompt. If the supporting context does not closely relate to the user's prompt, ignore it as you formulate a response. If the user's prompt refers to any previous messages, ignore the supporting context as you formulate a response. Your response should always be in markdown format. The supporting context will be in the following format: <context>supporting context</context>. You may also be provided an array of touples containing display links and links. If you are provided this array, tell the user that they may find more information about their question by checking out the links. The display link should be the text that is shown to the user, and the link url should be the link in the touple. The array of links will be in the following format: <linksArray>[array]</linksArray> A touple in this array will have the following format: '{displayLink: \"example.com\", link: \"https://example.com\"}")+`\n\n            <context>${JSON.stringify(C)}</context>\n            <linksArray>${JSON.stringify(A)}</linksArray>\n            `},{role:"user",content:g}],temperature:(null==S?void 0:S.completion_temperature)||.7},{headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`}});if(200!==I.status)return console.log(I.statusText),t.status(500),void t.send({ok:!1,data:[],message:I.statusText});{const e=I.data,{data:o,error:s}=yield p.from("chat_completion").upsert({id:e.id,object:e.object,created:e.created,model:e.model,role:e.choices[0].message.role,message:e.choices[0].message.content,finish_reason:e.choices[0].finish_reason,prompt_tokens:e.usage.prompt_tokens,completion_tokens:e.usage.completion_tokens,total_tokens:e.usage.total_tokens,user_id:f,chat_id:_,prompt:g,documents:C}).select().single();if(s)return console.log(s),t.status(500),void t.send({ok:!1,data:[],message:s.message});t.status(200),t.send({ok:!0,data:o,message:"success"})}}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),l.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET COMPLETION`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,a=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.chat_id,l=null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!a)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const c=u.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,r.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("chat_completion").select().eq("user_id",d).eq("chat_id",a).eq("id",l).single();if(m)return console.log(m),t.status(500),void t.send({ok:!1,data:[],message:m.message});t.status(200),t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=l},732:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET FEEDBACK`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,u=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.completion_id,l=null===(i=null==e?void 0:e.query)||void 0===i?void 0:i.chat_id;if(!d)return t.status(400),void t.send({ok:!1,data:void 0,message:"Authentication Error"});if(!u)return t.status(400),void t.send({ok:!1,data:void 0,message:"No Completions ID provided"});if(!l)return t.status(400),void t.send({ok:!1,data:void 0,message:"Invalid Request"});const c=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,a.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("completion_feedback").select().eq("user_id",d).eq("completion_id",u).eq("chat_id",l);if(m)throw new Error(m.message);return t.status(200),void t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d,u,l,c;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST FEEDBACK`);const v=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.user_id,g=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.completion_id,m=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.chat_id,f=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.rating_id,_=null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.rating,h=null===(l=null==e?void 0:e.body)||void 0===l?void 0:l.prompt,p=null===(c=null==e?void 0:e.body)||void 0===c?void 0:c.completion;if(!m)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!v)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!f)return t.status(400),void t.send({ok:!1,data:[],message:"No Rating ID provided"});if(!_)return t.status(400),void t.send({ok:!1,data:[],message:"No Rating provided"});if(!g)return t.status(400),void t.send({ok:!1,data:[],message:"No Completion ID provided"});if(!p)return t.status(400),void t.send({ok:!1,data:[],message:"No Completion provided"});if(!h)return t.status(400),void t.send({ok:!1,data:[],message:"No Prompt provided"});const y=r.default.sign({sub:v,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),E=(0,a.createClient)({req:e,res:t},y),{data:k,error:S}=yield E.from("completion_feedback").upsert([{user_id:v,id:f,chat_id:m,completion_id:g,created_at:(new Date).toISOString(),rating:_,prompt:h,completion:p}]).select().single();if(k)return t.status(200),void t.send({ok:!0,data:k,message:"success"});if(S)throw new Error(S.message)}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").delete(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – DELETE FEEDBACK`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,u=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.completion_id,l=null===(i=null==e?void 0:e.query)||void 0===i?void 0:i.chat_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!u)return t.status(400),void t.send({ok:!1,data:[],message:"No Completions ID provided"});if(!l)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});const c=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,a.createClient)({req:e,res:t},c),{error:g}=yield v.from("completion_feedback").delete().eq("user_id",d).eq("completion_id",u).eq("chat_id",l).single();if(!g)return t.status(200),void t.send({ok:!0,data:[],message:"success"});if(g)throw new Error(g.message)}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},12:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS CHATS`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.organization;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"No Organization provided"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{data:c,error:v}=yield l.from("higgins_chat").select().eq("user_id",i).eq("organization",d).order("created_at",{ascending:!0});if(v)return t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d,u;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST HIGGINS CHAT`);let l=(null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title)||"New Chat";const c=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.user_id,v=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.created_at,g=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.chat_id,m=null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.organization;if(!c)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!g)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!m)return t.status(400),void t.send({ok:!1,data:[],message:"No Organization provided"});const f=r.default.sign({sub:c,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),_=(0,a.createClient)({req:e,res:t},f),{data:h,error:p}=yield _.from("higgins_chat").select().eq("user_id",c).eq("organization",m).like("title",`%${l}%`);if(p)return t.status(500),void t.send({ok:!1,data:[],message:p.message});h&&h.length>1&&(l+=` ${h.length}`);const{data:y,error:E}=yield _.from("higgins_chat").upsert({id:g,created_at:v,user_id:c,organization:m,title:l}).select().single();return E?(t.status(500),void t.send({ok:!1,data:[],message:E.message})):(t.status(200),void t.send({ok:!0,data:y,message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS CHAT`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id;if(!i)return console.log("No User ID Provided"),t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{data:c,error:v}=yield l.from("higgins_chat").select().eq("user_id",i).eq("id",d).single();if(v)return console.log(v.message),t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").patch(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – PATCH HIGGINS CHAT`);const i=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title,d=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id,u=null==e?void 0:e.body.user_id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!u)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const l=r.default.sign({sub:u,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),c=(0,a.createClient)({req:e,res:t},l),{data:v,error:g}=yield c.from("higgins_chat").update({title:i}).eq("id",d).select().single();if(g)return t.status(500),void t.send({ok:!1,data:[],message:g.message});t.status(200),t.send({ok:!0,data:v,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").delete(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – DELETE HIGGINS CHATS`);const i=null===(s=null==e?void 0:e.params)||void 0===s?void 0:s.id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.user_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{error:c}=yield l.from("higgins_chat").delete().eq("id",i).eq("user_id",d).single();return c?(console.log(t),t.status(500),void t.send({ok:!1,data:[],message:c.message})):(t.status(200),void t.send({ok:!0,data:[],message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},228:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(356),d=n(o(252)),a=n(o(818)),r=n(o(938)),u=o(376),l=n(o(829));a.default.config();const c=d.default.Router();new i.ChromaClient({path:process.env.CHROMADB_PRO_URL}),new i.OpenAIEmbeddingFunction({openai_api_key:process.env.OPENAI_API_KEY}),c.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS COMPLETIONS`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.chat_id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const a=l.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),r=(0,u.createClient)({req:e,res:t},a),{data:c,error:v}=yield r.from("higgins_chat_completion").select().eq("user_id",i).eq("chat_id",d).order("created",{ascending:!0});if(v)return console.log(v),t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),c.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d,a,c,v,g;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST HIGGINS COMPLETION`);const m=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.system_directive,f=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.user_input,_=(null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.messages)||[],h=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.user_id,p=null===(a=null==e?void 0:e.body)||void 0===a?void 0:a.chat_id,y=null===(c=null==e?void 0:e.body)||void 0===c?void 0:c.chat_id,E=null===(v=null==e?void 0:e.body)||void 0===v?void 0:v.organization;if(!f)return t.status(400),void t.send({ok:!1,data:[],message:"No User Input Provided"});if(!h)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!p)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!E)return t.status(400),void t.send({ok:!1,data:[],message:"No Organization Provided"});const k=l.default.sign({sub:h,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),S=(0,u.createClient)({req:e,res:t},k),q=yield(0,u.getRelatedDocs)(f,E),b=null===(g=null==q?void 0:q.at(0))||void 0===g?void 0:g.map((e=>null==e?void 0:e.replace("\n"," ")));console.log(b);const C=`Your name is Higgins. You are a helpful assistant for the company ${E}. You may be provided with some supporting context that you can use to help you respond to the user's next prompt. If the supporting context does not closely relate to the user's prompt, ignore it as you formulate a response. If the user's prompt refers to any previous messages, ignore the supporting context as you formulate a response. The supporting context will be in the following format: <context>supporting context</context>.\n    \n    <context>${JSON.stringify(b)}</context>`,A=yield r.default.post("https://api.openai.com/v1/chat/completions",{model:"gpt-4-turbo-preview",messages:[..._,{role:"system",content:m?m+b:C},{role:"user",content:f}],temperature:y?Number(y):.7},{headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`}});if(200!==A.status)return console.log(A.statusText),t.status(500),void t.send({ok:!1,data:[],message:A.statusText});{const e=A.data,{data:o,error:s}=yield S.from("higgins_chat_completion").insert({id:e.id,object:e.object,created:e.created,model:e.model,role:e.choices[0].message.role,message:e.choices[0].message.content,finish_reason:e.choices[0].finish_reason,prompt_tokens:e.usage.prompt_tokens,completion_tokens:e.usage.completion_tokens,total_tokens:e.usage.total_tokens,user_id:h,chat_id:p,prompt:f,documents:b}).select().single();if(s)return console.log(s),t.status(500),void t.send({ok:!1,data:[],message:s.message});t.status(200),t.send({ok:!0,data:o,message:"success"})}}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),c.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS COMPLETION`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,a=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id,r=null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!a)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const c=l.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,u.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("higgins_chat_completion").select().eq("user_id",d).eq("chat_id",a).eq("id",r).single();if(m)return console.log(m),t.status(500),void t.send({ok:!1,data:[],message:m.message});t.status(200),t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=c},718:function(e,t,o){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(o(252)),i=s(o(237)),d=s(o(827)),a=s(o(257)),r=s(o(12)),u=s(o(228)),l=s(o(732)),c=s(o(470)),v=s(o(61)),g=n.default.Router();g.get("/status",((e,t)=>t.send("OK"))),g.use("/completion",i.default),g.use("/collection",d.default),g.use("/chat",a.default),g.use("/higgins-chat",r.default),g.use("/higgins-completion",u.default),g.use("/feedback",l.default),g.use("/public",c.default),g.use("/industry",v.default),t.default=g},61:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET INDUSTRIES`);const n=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id;if(!n)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const i=r.default.sign({sub:n,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),d=(0,a.createClient)({req:e,res:t},i),{data:u,error:l}=yield d.from("industry").select("*").order("created_at",{ascending:!0});if(l)return t.status(500),void t.send({ok:!1,data:[],message:l.message});console.log(u),t.status(200),t.send({ok:!0,data:u,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},113:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET PUBLIC CHATS`);const n=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id;if(!n)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const i=r.default.sign({sub:n,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),d=(0,a.createClient)({req:e,res:t},i),{data:u,error:l}=yield d.from("public_chat").select().eq("user_id",n);if(l)return t.status(500),void t.send({ok:!1,data:[],message:l.message});t.status(200),t.send({ok:!0,data:u,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST PUBLIC CHAT`);let u=(null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title)||"New Chat";const l=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.user_id,c=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.created_at,v=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.chat_id;if(!l)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!v)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});const g=r.default.sign({sub:l,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),m=(0,a.createClient)({req:e,res:t},g),{data:f,error:_}=yield m.from("public_chat").select().eq("user_id",l).like("title",`%${u}%`);if(_)return t.status(500),void t.send({ok:!1,data:[],message:_.message});f&&f.length>1&&(u+=` ${f.length}`);const{data:h,error:p}=yield m.from("public_chat").upsert({id:v,created_at:c,user_id:l,title:u}).select().single();return p?(t.status(500),void t.send({ok:!1,data:[],message:p.message})):(t.status(200),void t.send({ok:!0,data:h,message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET PUBLIC CHAT`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{data:c,error:v}=yield l.from("public_chat").select().eq("user_id",i).eq("id",d).single();if(v)return t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").patch(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – PATCH PUBLIC CHAT`);const d=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title,u=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id,l=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.user_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!l)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const c=r.default.sign({sub:l,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,a.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("public_chat").update({title:d}).eq("id",u).select().single();if(m)return t.status(500),void t.send({ok:!1,data:[],message:m.message});t.status(200),t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").delete(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – DELETE PUBLIC CHAT`);const i=null===(s=null==e?void 0:e.params)||void 0===s?void 0:s.id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.user_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{error:c}=yield l.from("public_chat").delete().eq("id",i).eq("user_id",d).single();return c?(console.log(c),t.status(500),void t.send({ok:!1,data:[],message:c.message})):(t.status(200),void t.send({ok:!0,data:[],message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},531:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(356),d=n(o(252));n(o(818)).default.config();const a=d.default.Router(),r=new i.ChromaClient({path:process.env.CHROMADB_PUBLIC_URL});a.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){const e=yield r.listCollections();e&&e.length>0?t.send(e):t.send("No collections found")})))),t.default=a},669:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=n(o(938)),r=o(376),u=n(o(829));d.default.config();const l=i.default.Router();l.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET PUBLIC COMPLETIONS`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.chat_id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const a=u.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,r.createClient)({req:e,res:t},a),{data:c,error:v}=yield l.from("public_chat_completion").select().eq("user_id",i).eq("chat_id",d).order("created",{ascending:!0});if(v)return console.log(v),t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),l.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST PUBLIC COMPLETION`);const l=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.user_input,c=(null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.messages)||[],v=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.user_id,g=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.chat_id;if(!l)return t.status(400),void t.send({ok:!1,data:[],message:"No User Input Provided"});if(!v)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!g)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});const m=u.default.sign({sub:v,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),f=(0,r.createClient)({req:e,res:t},m),_=yield a.default.post("https://api.openai.com/v1/chat/completions",{model:"gpt-4-turbo-preview",messages:[...c,{role:"system",content:"You are a helpful assistant"},{role:"user",content:l}]},{headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`}});if("OK"!==_.statusText)return console.log(_.statusText),t.status(500),void t.send({ok:!1,data:[],message:_.statusText});{const e=_.data,{data:o,error:s}=yield f.from("public_chat_completion").upsert({id:e.id,object:e.object,created:e.created,model:e.model,role:e.choices[0].message.role,message:e.choices[0].message.content,finish_reason:e.choices[0].finish_reason,prompt_tokens:e.usage.prompt_tokens,completion_tokens:e.usage.completion_tokens,total_tokens:e.usage.total_tokens,user_id:v,chat_id:g,prompt:l}).select().single();if(s)return console.log(s),t.status(500),void t.send({ok:!1,data:[],message:s.message});t.status(200),t.send({ok:!0,data:o,message:"success"})}}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),l.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET PUBLIC COMPLETION`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,a=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.chat_id,l=null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!a)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const c=u.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,r.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("public_chat_completion").select().eq("user_id",d).eq("chat_id",a).eq("id",l).single();if(m)return console.log(m),t.status(500),void t.send({ok:!1,data:[],message:m.message});t.status(200),t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=l},380:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET PUBLIC FEEDBACK`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,u=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.completion_id,l=null===(i=null==e?void 0:e.query)||void 0===i?void 0:i.chat_id;if(!d)return t.status(400),void t.send({ok:!1,data:void 0,message:"Authentication Error"});if(!u)return t.status(400),void t.send({ok:!1,data:void 0,message:"No Completions ID provided"});if(!l)return t.status(400),void t.send({ok:!1,data:void 0,message:"Invalid Request"});const c=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,a.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("public_completion_feedback").select().eq("user_id",d).eq("completion_id",u).eq("chat_id",l);if(m)throw new Error(m.message);return t.status(200),void t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d,u,l,c;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST PUBLIC FEEDBACK`);const v=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.user_id,g=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.completion_id,m=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.chat_id,f=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.rating_id,_=null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.rating,h=null===(l=null==e?void 0:e.body)||void 0===l?void 0:l.prompt,p=null===(c=null==e?void 0:e.body)||void 0===c?void 0:c.completion;if(!m)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!v)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!f)return t.status(400),void t.send({ok:!1,data:[],message:"No Rating ID provided"});if(!_)return t.status(400),void t.send({ok:!1,data:[],message:"No Rating provided"});if(!g)return t.status(400),void t.send({ok:!1,data:[],message:"No Completion ID provided"});if(!p)return t.status(400),void t.send({ok:!1,data:[],message:"No Completion provided"});if(!h)return t.status(400),void t.send({ok:!1,data:[],message:"No Prompt provided"});const y=r.default.sign({sub:v,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),E=(0,a.createClient)({req:e,res:t},y),{data:k,error:S}=yield E.from("public_completion_feedback").upsert([{user_id:v,id:f,chat_id:m,completion_id:g,created_at:(new Date).toISOString(),rating:_,prompt:h,completion:p}]).select().single();if(k)return t.status(200),void t.send({ok:!0,data:k,message:"success"});if(S)throw new Error(S.message)}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").delete(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – DELETE PUBLIC FEEDBACK`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,u=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.completion_id,l=null===(i=null==e?void 0:e.query)||void 0===i?void 0:i.chat_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!u)return t.status(400),void t.send({ok:!1,data:[],message:"No Completions ID provided"});if(!l)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});const c=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,a.createClient)({req:e,res:t},c),{error:g}=yield v.from("public_completion_feedback").delete().eq("user_id",d).eq("completion_id",u).eq("chat_id",l).single();if(!g)return t.status(200),void t.send({ok:!0,data:[],message:"success"});if(g)throw new Error(g.message)}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},236:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS PUBLIC CHATS`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.organization_id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"No Organization ID provided"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{data:c,error:v}=yield l.from("higgins_public_chat").select().eq("user_id",i).eq("organization_id",d).order("created_at",{ascending:!0});if(v)return t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i,d,u;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST HIGGINS PUBLIC CHAT`);let l=(null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title)||"New Chat";const c=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.user_id,v=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.created_at,g=null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.chat_id,m=null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.organization_id;if(!c)return t.status(400),t.send({ok:!1,data:[],message:"Authentication Error"}),void console.log("ERROR: No user ID provided");if(!g)return t.status(400),t.send({ok:!1,data:[],message:"Invalid Request"}),void console.log("ERROR: No chat ID provided");if(!m)return t.status(400),t.send({ok:!1,data:[],message:"No Organization provided"}),void console.log("ERROR: No organization ID provided");const f=r.default.sign({sub:c,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),_=(0,a.createClient)({req:e,res:t},f),{data:h,error:p}=yield _.from("higgins_public_chat").select().eq("user_id",c).eq("organization_id",m).like("title",`%${l}%`);if(p)return t.status(500),void t.send({ok:!1,data:[],message:p.message});h&&h.length>1&&(l+=` ${h.length}`);const{data:y,error:E}=yield _.from("higgins_public_chat").upsert({id:g,created_at:v,user_id:c,organization_id:m,title:l}).select().single();return E?(t.status(500),void t.send({ok:!1,data:[],message:E.message})):(t.status(200),void t.send({ok:!0,data:y,message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS PUBLIC CHAT`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{data:c,error:v}=yield l.from("higgins_public_chat").select().eq("user_id",i).eq("id",d).single();if(v)return t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").patch(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – PATCH HIGGINS PUBLIC CHAT`);const i=null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.title,d=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id,u=null==e?void 0:e.body.user_id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!u)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const l=r.default.sign({sub:u,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),c=(0,a.createClient)({req:e,res:t},l),{data:v,error:g}=yield c.from("higgins_public_chat").update({title:i}).eq("id",d).select().single();if(g)return t.status(500),void t.send({ok:!1,data:[],message:g.message});t.status(200),t.send({ok:!0,data:v,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").delete(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – DELETE HIGGINS PUBLIC CHAT`);const i=null===(s=null==e?void 0:e.params)||void 0===s?void 0:s.id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.user_id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{error:c}=yield l.from("higgins_public_chat").delete().eq("id",i).eq("user_id",d).single();return c?(console.log(t),t.status(500),void t.send({ok:!1,data:[],message:c.message})):(t.status(200),void t.send({ok:!0,data:[],message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},284:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(356),d=n(o(252)),a=n(o(818)),r=n(o(938)),u=o(376),l=n(o(829));a.default.config();const c=d.default.Router(),v=new i.ChromaClient({path:process.env.CHROMADB_PUBLIC_URL}),g=new i.OpenAIEmbeddingFunction({openai_api_key:process.env.OPENAI_API_KEY});c.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS PUBLIC COMPLETIONS`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.chat_id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const a=l.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),r=(0,u.createClient)({req:e,res:t},a),{data:c,error:v}=yield r.from("higgins_public_chat_completion").select().eq("user_id",i).eq("chat_id",d).order("created",{ascending:!0});if(v)return console.log(v),t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),c.route("/").post(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,n,i,d,a,c,m,f,_;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.user_id} – POST HIGGINS PUBLIC COMPLETION`);const h=null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.system_directive,p=null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.user_input,y=(null===(d=null==e?void 0:e.body)||void 0===d?void 0:d.messages)||[],E=null===(a=null==e?void 0:e.body)||void 0===a?void 0:a.user_id,k=null===(c=null==e?void 0:e.body)||void 0===c?void 0:c.chat_id,S=null===(m=null==e?void 0:e.body)||void 0===m?void 0:m.chat_id,q=null===(f=null==e?void 0:e.body)||void 0===f?void 0:f.organization;if(!p)return t.status(400),void t.send({ok:!1,data:[],message:"No User Input Provided"});if(!E)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!k)return t.status(400),void t.send({ok:!1,data:[],message:"Invalid Request"});if(!q)return t.status(400),void t.send({ok:!1,data:[],message:"No Organization Provided"});const b=l.default.sign({sub:E,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),C=(0,u.createClient)({req:e,res:t},b),A=yield((e,t)=>s(void 0,void 0,void 0,(function*(){const o=yield v.getCollection({name:t,embeddingFunction:g}),s=yield o.query({queryTexts:e,nResults:5});if(null==s?void 0:s.documents)return s.documents})))(p,q),I=null===(_=null==A?void 0:A.at(0))||void 0===_?void 0:_.map((e=>null==e?void 0:e.replace("\n"," "))),w=`Your name is Higgins. You are a helpful assistant for the company ${q}. I will provide you some supporting documents that you can use to help you respond to the user's next prompt. If the supporting documents do not closely relate to the user's prompt, ignore them as you formulate a response. If the user's prompt refers to any previous messages, ignore the supporting documents as you formulate a response. The following text is the supporting documents: ${I}`,T=yield r.default.post("https://api.openai.com/v1/chat/completions",{model:"gpt-4-turbo-preview",messages:[...y,{role:"system",content:h?h+I:w},{role:"user",content:p}],temperature:S?Number(S):.7},{headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`}});if("OK"!==T.statusText)return console.log(T.statusText),t.status(500),void t.send({ok:!1,data:[],message:T.statusText});{const e=T.data,{data:o,error:s}=yield C.from("higgins_public_chat_completion").insert({id:e.id,object:e.object,created:e.created,model:e.model,role:e.choices[0].message.role,message:e.choices[0].message.content,finish_reason:e.choices[0].finish_reason,prompt_tokens:e.usage.prompt_tokens,completion_tokens:e.usage.completion_tokens,total_tokens:e.usage.total_tokens,user_id:E,chat_id:k,prompt:p,documents:I}).select().single();if(s)return console.log(s),t.status(500),void t.send({ok:!1,data:[],message:s.message});t.status(200),t.send({ok:!0,data:o,message:"success"})}}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),c.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n,i;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET HIGGINS PUBLIC COMPLETION`);const d=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,a=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id,r=null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.id;if(!d)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});if(!a)return t.status(400),void t.send({ok:!1,data:[],message:"No Chat Input Provided"});const c=l.default.sign({sub:d,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),v=(0,u.createClient)({req:e,res:t},c),{data:g,error:m}=yield v.from("higgins_public_chat_completion").select().eq("user_id",d).eq("chat_id",a).eq("id",r).single();if(m)return console.log(m),t.status(500),void t.send({ok:!1,data:[],message:m.message});t.status(200),t.send({ok:!0,data:g,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=c},470:function(e,t,o){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(o(252)),i=s(o(669)),d=s(o(531)),a=s(o(113)),r=s(o(236)),u=s(o(284)),l=s(o(380)),c=s(o(185)),v=n.default.Router();v.get("/status",((e,t)=>t.send("PUBLIC OK"))),v.use("/completion",i.default),v.use("/collection",d.default),v.use("/chat",a.default),v.use("/higgins-chat",r.default),v.use("/higgins-completion",u.default),v.use("/feedback",l.default),v.use("/organization",c.default),t.default=v},185:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(252)),d=n(o(818)),a=o(376),r=n(o(829));d.default.config();const u=i.default.Router();u.route("/").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET PUBLIC ORGANIZATIONS`);const n=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id;if(!n)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const i=r.default.sign({sub:n,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),d=(0,a.createClient)({req:e,res:t},i),{data:u,error:l}=yield d.from("higgins_ai_public_organization").select();return l?(t.status(500),void t.send({ok:!1,data:[],message:l.message})):u?(t.status(200),void t.send({ok:!0,data:u,message:"success"})):(t.status(200),void t.send({ok:!0,data:[],message:"success"}))}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),u.route("/:id").get(((e,t)=>s(void 0,void 0,void 0,(function*(){var o,s,n;try{console.log(`USER_ID: ${null===(o=null==e?void 0:e.query)||void 0===o?void 0:o.user_id} – GET PUBLIC ORGANIZATION`);const i=null===(s=null==e?void 0:e.query)||void 0===s?void 0:s.user_id,d=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.id;if(!i)return t.status(400),void t.send({ok:!1,data:[],message:"Authentication Error"});const u=r.default.sign({sub:i,role:"authenticated"},process.env.SUPABASE_JWT_SECRET),l=(0,a.createClient)({req:e,res:t},u),{data:c,error:v}=yield l.from("higgins_ai_public_organization").select().eq("user_id",i).eq("id",d).single();if(v)return t.status(500),void t.send({ok:!1,data:[],message:v.message});t.status(200),t.send({ok:!0,data:c,message:"success"})}catch(e){return console.log(e),t.status(500),void t.send({ok:!1,data:[],message:"Something went wrong"})}})))),t.default=u},376:function(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function d(e){try{r(s.next(e))}catch(e){i(e)}}function a(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,a)}r((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.customGoogleSearch=t.getRelatedDocs=t.createClient=void 0;const n=o(405),i=o(356),d=o(850);t.createClient=(e,t)=>(0,n.createServerClient)(process.env.SUPABASE_URL,process.env.SUPABASE_ANON_KEY,{global:{headers:{Authorization:t?`Bearer ${t}`:""}},cookies:{get:t=>{var o;if(!t)return;const s=null!==(o=e.req.cookies[t])&&void 0!==o?o:"";return s?decodeURIComponent(s):void 0},set:(t,o,s)=>{e.res&&e.res.cookie(t,encodeURIComponent(o),Object.assign(Object.assign({},s),{sameSite:"Lax",httpOnly:!0}))},remove:(t,o)=>{e.res&&e.res.cookie(t,"",Object.assign(Object.assign({},o),{httpOnly:!0}))}}}),t.getRelatedDocs=(e,t)=>s(void 0,void 0,void 0,(function*(){try{if(console.log(t),!t)return;const o=new i.ChromaClient({path:process.env.CHROMADB_PRO_URL}),s=new i.OpenAIEmbeddingFunction({openai_api_key:process.env.OPENAI_API_KEY}),n=yield o.getCollection({name:t,embeddingFunction:s}),d=yield n.query({queryTexts:e,nResults:5});if(!d.documents)return;return d.documents}catch(e){return console.log("GET RELATED DOCS ERROR"),void console.log(e)}})),t.customGoogleSearch=e=>s(void 0,void 0,void 0,(function*(){var t;const o=d.google.customsearch({version:"v1"});return null===(t=(yield o.cse.list({q:e,cx:process.env.GOOGLE_CUSTOM_SEARCH_ENGINE_ID,key:process.env.GOOGLE_CLOUD_API_KEY})).data.items)||void 0===t?void 0:t.map((e=>({displayLink:e.displayLink,link:e.link})))}))},156:function(e,t,o){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(o(766)),i=process.env.PORT||4e3;n.default.listen(i,(()=>console.log("Listening on port "+i)))},405:e=>{e.exports=require("@supabase/ssr")},938:e=>{e.exports=require("axios")},356:e=>{e.exports=require("chromadb")},898:e=>{e.exports=require("cookie-parser")},577:e=>{e.exports=require("cors")},818:e=>{e.exports=require("dotenv")},252:e=>{e.exports=require("express")},850:e=>{e.exports=require("googleapis")},829:e=>{e.exports=require("jsonwebtoken")}},t={};!function o(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,o),i.exports}(156)})();
//# sourceMappingURL=bundle.js.map